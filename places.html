<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>My MEVO stations</title>
        <style>
html, body {
    font-family: Verdana,sans-serif;
    font-size: 20px;
    line-height: 1.5;
    background-color: #ebeff0;
    color: #384977;
}
h1 {
    background-color: #bfe3f0;
    color: #ea5144;
    padding: 5px;
}
.available {color: green;}
.one   {color: yellowgreen;}
.none  {color: red;}
        </style>
        <script src="https://rowermevo.pl/locations.js"></script>
    </head>
    <body>
        <h1>My MEVO stations</h1>
        <ul id="places"></ul>
        <p>See <a href="https://github.com/pvessel/my-mevo-stations">Github</a> for more details.</p>
        <script>
myPlacesIds = getMyPlacesIds();
allPlaces = getAllPlaces();
myPlaces = getMyPlaces(allPlaces, myPlacesIds);
html = createHtml(myPlaces);
myPlacesList = document.getElementById("places");
myPlacesList.innerHTML = html;

function getMyPlacesIds() {
    const urlParams = new URLSearchParams(window.location.search);
    const placesParam = urlParams.get('places');
    const trimmedPlaces = placesParam.trim();
    const myPlaces = trimmedPlaces.split(",");

    return myPlaces;
}

function getAllPlaces() {
    const placesDBparsed = JSON.parse(NEXTBIKE_PLACES_DB);
    const placesDB = placesDBparsed[0]['places'];
    
    return placesDB;
}

function getMyPlaces(allPlaces, myPlacesIds) {
    var myPlaces = [];

    var allPlacesLength = allPlaces.length;
    var myPlacesLength = myPlacesIds.length;
    for (var i = 0; i < myPlacesLength; i++) {
    myPlacesId = myPlacesIds[i];
        number = myPlacesId.match(/[0-9]{4,}/);
        description = myPlacesId.replace(number, "");
        
        for (var j = 0; j < allPlacesLength; j++) {
            if(parseInt(number) === allPlaces[j]['number']) {
                found = allPlaces[j];
                found["description"] = description;
                myPlaces.push(found);
                break; // assuming station no exist one in all stations area
            }
        }
    }

    return myPlaces;
}

function createHtml(myPlaces) {
    var html = "";
    var arrayLength = myPlaces.length;
    for (var i = 0; i < arrayLength; i++) {
        if(myPlaces[i]['bikes'] > 1) {
            html += ' <li class="available"> ';
        } else if(myPlaces[i]['bikes'] == 1) {
            html += ' <li class="one"> ';           
        } else {
            html += ' <li class="none"> '; 
        }

        html = html.concat(myPlaces[i]['bikes'] + 'ðŸš² - ' + myPlaces[i]['description'] + ' ' + myPlaces[i]['city'] + ' station no. ' + myPlaces[i]['name'] + '</li>' );
    }
    
    return html;
}


</script>
        
    </body>
</html>
